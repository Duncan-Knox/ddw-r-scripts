if(length(new.packages)) install.packages(new.packages)
library("foreign")
library("readr")
setwd("H:/Nigeria MICS 2016-17 SPSS Datasets/bh.sav")
bh_nat = read.spss("H:/Nigeria MICS 2016-17 SPSS Datasets/bh.sav")
var_labs = data.frame(names(bh_nat),attributes(bh_nat)$variable.labels)
names(var_labs) = c("variable name","variable label")
write_csv(data.frame(bh_nat),"bh_nat.csv")
write_csv(var_labs,"bh_var_labs.csv")
list.of.packages <- c("foreign","readr")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
library("foreign")
library("readr")
setwd("H:/Nigeria MICS 2016-17 SPSS Datasets/ch.sav")
ch_nat = read.spss("H:/Nigeria MICS 2016-17 SPSS Datasets/ch.sav")
var_labs = data.frame(names(ch_nat),attributes(ch_nat)$variable.labels)
names(var_labs) = c("variable name","variable label")
write_csv(data.frame(ch_nat),"ch_nat.csv")
write_csv(var_labs,"ch_var_labs.csv")
list.of.packages <- c("foreign","readr")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
library("foreign")
library("readr")
setwd("H:/Nigeria MICS 2016-17 SPSS Datasets/fg.sav")
fg_nat = read.spss("H:/Nigeria MICS 2016-17 SPSS Datasets/fg.sav")
var_labs = data.frame(names(fg_nat),attributes(fg_nat)$variable.labels)
names(var_labs) = c("variable name","variable label")
write_csv(data.frame(fg_nat),"fg_nat.csv")
write_csv(var_labs,"fg_var_labs.csv")
```install.packages("RPostgreSQL")```
install.packages("RPostgreSQL")
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
setwd("~/")
```{r}
api <- 'http://api.worldbank.org/v2/'
```
api <- 'http://api.worldbank.org/v2/'
api <- 'http://api.worldbank.org/v2/'
api <- 'http://api.worldbank.org/v2/'
api <- 'http://api.worldbank.org/v2/'
url_list_lic<- 'http://api.worldbank.org/v2/incomeLevels/LIC/countries'
list_lic<-GET(url_list_lic)
list_lic
list_lic<-GET(url= paste0(url_list_lic, '?format=json'))
list_lic
mrv_url<-'http://api.worldbank.org/v2/countries/chn;bra/indicators/DPANUSIFS?MRV=5'
mrv_url<-'http://api.worldbank.org/v2/countries/chn;bra/indicators/DPANUSIFS?MRV=5'
mrnev_url<-'http://api.worldbank.org/v2/countries/BR;CR/indicators/SH.STA.MMRT.NE?MRNEV=1'
gapfill_url_mrv<-'http://api.worldbank.org/v2/countries/chn;bra/indicators/DPANUSIFS?MRV=5&Gapfill=Y'
freq<-'http://api.worldbank.org/v2/en/countries/ind;chn/indicators/DPANUSSPF?date=2000:2006&MRV=5&frequency=M'
get_freq<-GET(freq)
get_freq
GET("http://www.google.com")
get_json_freq<-GET(url= paste0(freq,'&format=json'))
get_json_freq
list_indicators<-'http://api.worldbank.org/v2/indicators?format=json'
list_indicators_json<-GET(list_indicators)
list_indicators_content<- content(list_indicators_json)
head(list_indicators_content[[1]])
tmp = tempfile()
download.file(list_indicators,tmp)
indicators_list = fromJSON(tmp)
indicators_list
indicators_list
indicators_list[[2]]$id
View(indicators_list)
View(indicators_list)
View(indicators_list)
is.list(indicators_list)
is.data.frame(indicators_list)
indicators_list[[1]]
indicators_list[[2]]
view(indicators_list[[2]])
view(indicators_list[[2]])
View(indicators_list[[2]])
# df stands for data frame
indicators_df<- indicators_list[[2]]
is.data.frame(indicators_df)
names(indicators_df)
indicators_df[,c("id","name")]
unlist(x)
a=rnorm(50)
b=rnorm(50)
help(rnorm)
p<-plot_ly(x=a, y=b, type='scatter', mode='markers', size=a)
p
\view(p)
View(p)
brazil_url<-'http://api.worldbank.org/v2/countries/br/indicators/1.2.PGap.Poor4uds?format=json'
colombia_url<-'http://api.worldbank.org/v2/countries/co/indicators/1.2.PGap.Poor4uds?format=json'
tmp = tempfile()
download.file(brazil_url,tmp)
poverty_gap_content_br<-fromJSON(tmp)
tmp = tempfile()
download.file(colombia_url,tmp)
poverty_gap_content_co<-fromJSON(tmp)
poverty_gap_content_br[[1]]
brazil_poverty_gap<-poverty_gap_content_br[[2]]
colombia_poverty_gap<-poverty_gap_content_co[[2]]
colombia_poverty_gap_date_value<-colombia_poverty_gap[,c("date","value")]
brazil_poverty_gap_date_value<-brazil_poverty_gap[,c("date","value")]
colombia_poverty_gap_date_value <- lapply(colombia_poverty_gap_date_value, function(x) {
x[sapply(x, is.null)] <- NA
unlist(x)
})
brazil_poverty_gap_date_value <- lapply(brazil_poverty_gap_date_value, function(x) {
x[sapply(x, is.null)] <- NA
unlist(x)
})
brazil<-plot_ly(y=brazil_poverty_gap_date_value$value, x=brazil_poverty_gap_date_value$date, type='scatter', mode='lines')
brazil
colombia<-plot_ly(y=colombia_poverty_gap_date_value$value, x=colombia_poverty_gap_date_value$date, type='scatter', mode='lines')
colombia
combined<-plot_ly(y=colombia_poverty_gap_date_value$value, x=colombia_poverty_gap_date_value$date, name='Colombia', type='scatter', mode='lines') %>%
add_trace(y=brazil_poverty_gap_date_value$value, name="Brazil", mode='lines')
combined
library(openxlsx)
library(data.table)
meta_path = "S:/Projects/P0284 Development Data Hub/2018 PDF Profile Updates/Metadata/all_ddh_metadata.xlsx"
meta = read.xlsx(meta_path)
missing_source = subset(meta,is.na(source))
missing_source$flow.id = gsub("_","-",sapply(strsplit(missing_source$id,split="."),`[[`,index=1)))
flows = read.csv("https://github.com/devinit/datahub-cms/blob/master/country-profile/flow-name.csv",na.strings="")
flows = flows[,c("id","source")]
setnames(flows,"id","flow.id")
setnames(flows,"source","flow.source")
matches = merge(missing_source,flows,by="flow.id",all.x=T)
View(matches)
library(openxlsx)
library(data.table)
meta_path = "S:/Projects/P0284 Development Data Hub/2018 PDF Profile Updates/Metadata/all_ddh_metadata.xlsx"
meta = read.xlsx(meta_path)
missing_source = subset(meta,is.na(source))
missing_source$flow.id = gsub("_","-",sapply(strsplit(missing_source$id,split="."),`[[`,index=1)))
flows = read.csv("https://github.com/devinit/datahub-cms/blob/master/country-profile/flow-name.csv",na.strings="")
flows = flows[,c("id","source")]
setnames(flows,"id","flow.id")
setnames(flows,"source","flow.source")
matches = merge(missing_source,flows,by="flow.id",all.x=T)
View(matches)
View(non_matches)
library(openxlsx)
library(data.table)
meta_path = "S:/Projects/P0284 Development Data Hub/2018 PDF Profile Updates/Metadata/all_ddh_metadata.xlsx"
meta = read.xlsx(meta_path)
missing_source = subset(meta,is.na(source))
missing_source$flow.id = gsub("_","-",sapply(strsplit(missing_source$id,split=".",fixed=T),`[[`,index=2))
flows = read.csv("https://raw.githubusercontent.com/devinit/datahub-cms/master/country-profile/flow-name.csv",na.strings="")
flows = flows[,c("id","source")]
setnames(flows,"id","flow.id")
setnames(flows,"source","flow.source")
matches = merge(missing_source,flows,by="flow.id")
non_matches = subset(missing_source,!(id %in% unique(matches$id)))
View(matches)
View(non_matches)
View(matches)
list.of.packages <- c("data.table","openxlsx","WDI","varhandle","reshape2")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
wd='C:/git/ddw-r-scripts'
setwd(wd)
#oda percent gdp historical
oda=read.xlsx("comparisons/OECD CRS ODA data.xlsx",sheet="OECD.Stat export",startRow=10,na.strings = "")
oda=subset(oda,!is.na(di.id))
setnames(oda,"Year","country")
oda=melt(oda,id.vars=c("di id","country"),variable.name="year")
oda$value=oda$value*1000000
pop=WDI(country="all",indicator="SP.POP.TOTL",start=1995,end=2016,extra=T)
keep=c("iso2c","year","NY.GDP.MKTP.CD")
pop=pop[keep]
names(pop)=c("di id","year","gdp")
oda_per_capita=merge(oda,pop,by=c("di id","year"))
setdiff(unique(oda$di id),unique(oda_percent_gdp$di id))
setdiff(unique(oda_per_capita$di id),unique(oda$di id))
oda_per_capita$value=oda_per_capita$value/oda_per_capita$pop
oda_per_capita$pop=NULL
oda_per_capita.rp=read.csv("output/recipient_profile.oda_per_capita_constant.csv",na.strings = "")
setnames(oda_per_capita.rp,"di_id","di id")
oda_per_capita.merge=merge(oda_per_capita.rp,oda_per_capita,by=c("di id","year"),all.x=T)
oda_per_capita.merge$value.x=as.numeric(unfactor(oda_per_capita.merge$value.x))
oda_per_capita.merge$diff=(oda_per_capita.merge$value.x-oda_per_capita.merge$value.y)/(oda_per_capita.merge$value.x)
write.csv(oda_per_capita.merge,"comparisons/oda_per_capita__historical_comparison.csv",na="",row.names=F)
list.of.packages <- c("data.table","openxlsx","WDI","varhandle","reshape2")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
wd='C:/git/ddw-r-scripts'
setwd(wd)
#oda per capita historical
oda=read.xlsx("comparisons/OECD CRS ODA data.xlsx",sheet="OECD.Stat export",startRow=10,na.strings = "")
oda=subset(oda,!is.na(di.id))
setnames(oda,"Year","country")
oda=melt(oda,id.vars=c("di id","country"),variable.name="year")
oda$value=oda$value*1000000
pop=WDI(country="all",indicator="SP.POP.TOTL",start=1995,end=2016,extra=T)
keep=c("iso2c","year","NY.GDP.MKTP.CD")
pop=pop[keep]
names(pop)=c("di id","year","value")
oda_per_capita=merge(oda,pop,by=c("di id","year"))
setdiff(unique(oda$di id),unique(oda_per_capita$di id))
setdiff(unique(oda_per_capita$di id),unique(oda$di id))
oda_per_capita$value=oda_per_capita$value/oda_per_capita$pop
oda_per_capita$pop=NULL
oda_per_capita.rp=read.csv("output/recipient_profile.oda_per_capita_constant.csv",na.strings = "")
setnames(oda_per_capita.rp,"di_id","di id")
oda_per_capita.merge=merge(oda_per_capita.rp,oda_per_capita,by=c("di id","year"),all.x=T)
oda_per_capita.merge$value.x=as.numeric(unfactor(oda_per_capita.merge$value.x))
oda_per_capita.merge$diff=(oda_per_capita.merge$value.x-oda_per_capita.merge$value.y)/(oda_per_capita.merge$value.x)
write.csv(oda_per_capita.merge,"comparisons/oda_per_capita__historical_comparison.csv",na="",row.names=F)
View(oda_per_capita.rp)
list.of.packages <- c("data.table","openxlsx","WDI","varhandle","reshape2")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
wd='C:/git/ddw-r-scripts'
setwd(wd)
oda=read.xlsx("comparisons/OECD CRS ODA data.xlsx",sheet="OECD.Stat export",startRow=10,na.strings = "")
oda=subset(oda,!is.na(di.id))
oda=subset(oda,!is.na(di.id))
oda=subset(oda,!is.na(di.id))
setnames(oda,"Year","country")
View(oda)
oda=subset(oda,!is.na(di id))
oda=subset(oda,!is.na(di_id))
list.of.packages <- c("data.table","openxlsx","WDI","varhandle","reshape2")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
oda=read.xlsx("comparisons/OECD CRS ODA data.xlsx",sheet="OECD.Stat export",startRow=10,na.strings = "")
oda=subset(oda,!is.na(di_id))
oda=subset(oda,!is.na(di id))
oda=subset(oda,!is.na(di.id))
setnames(oda,"Year","country")
list.of.packages <- c("data.table","openxlsx","WDI","varhandle","reshape2")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
wd='C:/git/ddw-r-scripts'
setwd(wd)
#oda percent gdp
oda=read.xlsx("comparisons/ODA percent GDP.xlsx",sheet="ODA current",startRow=10,na.strings = "")
oda=subset(oda,!is.na(di.id))
setnames(oda,"Year","country")
list.of.packages <- c("data.table","openxlsx","WDI","varhandle","reshape2")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only=T)
wd='C:/git/ddw-r-scripts'
setwd(wd)
#oda per capita historical
oda2=read.xlsx("comparisons/OECD CRS ODA data.xlsx",sheet="OECD.Stat export",startRow=10,na.strings = "")
oda2=subset(oda,!is.na(di.id))
setnames(oda,"Year","country")
oda2=subset(oda2,!is.na(di.id))
setnames(oda,"Year","country")
setnames(oda2,"Year","country")
?
?'old'
?"old"
